# Руководство по экспорту данных мест в Supabase

Это руководство поможет вам экспортировать все данные о местах из директории `/src/data` в вашу базу данных Supabase.

## Обзор

В проекте есть 13 зон с местами (201-213), каждая содержит от 132 до 233 мест. Всего **2222 места**.

## Автоматически созданные файлы

### 1. Скрипты экспорта
- `scripts/export-zones-to-supabase.mjs` - создает SQL для зон
- `scripts/export-seats-to-supabase.mjs` - создает SQL для мест

### 2. SQL файлы для импорта
- `supabase-zones-export.sql` - содержит INSERT запросы для 13 зон
- `supabase-seats-export.sql` - содержит INSERT запросы для 2222 мест

## Пошаговая инструкция

### Шаг 1: Подготовка базы данных
Убедитесь, что в вашей Supabase базе данных выполнены:
1. `schema.sql` - создание таблиц и структуры
2. `seed.sql` - базовые тестовые данные

### Шаг 2: Импорт зон
1. Откройте **Supabase SQL Editor**
2. Скопируйте содержимое файла `supabase-zones-export.sql`
3. Выполните SQL запрос

### Шаг 3: Импорт мест
1. В **Supabase SQL Editor**
2. Скопируйте содержимое файла `supabase-seats-export.sql`
3. Выполните SQL запрос

⚠️ **Важно**: Сначала импортируйте зоны, затем места, так как места ссылаются на зоны через `zone_id`.

## Структура данных

### Зоны (zones)
```sql
INSERT INTO zones (id, event_id, name, description) VALUES
  (201, 1, 'Зона 201', 'Зона 201 - автоматически созданная'),
  ...
```

### Места (seats)
```sql
INSERT INTO seats (id, zone_id, row_name, seat_number, x_coordinate, y_coordinate, status, fill_color) VALUES
  ('201-K-14', 201, 'K', '14', 515, 20, 'available', '#4ED784'),
  ...
```

## Статистика по зонам

| Зона | Количество мест |
|------|----------------|
| 201  | 132           |
| 202  | 167           |
| 203  | 150           |
| 204  | 219           |
| 205  | 137           |
| 206  | 185           |
| 207  | 233           |
| 208  | 185           |
| 209  | 136           |
| 210  | 219           |
| 211  | 150           |
| 212  | 167           |
| 213  | 142           |
| **Всего** | **2222** |

## Повторный запуск скриптов

Если нужно пересоздать SQL файлы:

```bash
# Создать зоны
node scripts/export-zones-to-supabase.mjs

# Создать места
node scripts/export-seats-to-supabase.mjs
```

## Проверка импорта

После импорта проверьте данные в Supabase:

```sql
-- Проверить количество зон
SELECT COUNT(*) FROM zones;
-- Должно быть 13

-- Проверить количество мест
SELECT COUNT(*) FROM seats;
-- Должно быть 2222

-- Проверить места по зонам
SELECT zone_id, COUNT(*) as seat_count 
FROM seats 
GROUP BY zone_id 
ORDER BY zone_id;
```

## Устранение проблем

### Ошибка "zone_id не существует"
- Убедитесь, что сначала импортированы зоны
- Проверьте, что event_id=1 существует в таблице events

### Ошибка дублирования
- Зоны: используется `ON CONFLICT (id) DO NOTHING`
- Места: если нужно обновить, сначала удалите существующие места

```sql
-- Удалить все места (если нужно пересоздать)
DELETE FROM seats WHERE zone_id BETWEEN 201 AND 213;
```

## Дополнительная информация

Данные извлекаются из TypeScript файлов в `/src/data/`, которые содержат:
- Уникальные ID мест (например, '201-K-14')
- Координаты X, Y для позиционирования
- Статус места ('available', 'unavailable', 'selected')
- Цвет заливки из SVG файлов
- Информацию о ряде и номере места