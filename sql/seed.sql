-- Тестовые данные для системы бронирования билетов

-- Вставка тестового события
INSERT INTO events (id, title, description, venue, event_date, doors_open, status, image_url) VALUES 
(
  '550e8400-e29b-41d4-a716-446655440000',
  'Концерт в Ледовом дворце',
  'Грандиозное музыкальное шоу с участием звезд эстрады',
  'Ледовый дворец "Арена"',
  '2024-12-31 20:00:00+03',
  '2024-12-31 19:00:00+03',
  'active',
  '/arena.svg'
);

-- Добавляем шаблоны зон (пример для зон 201-204)
INSERT INTO zone_templates (zone, row, number, x_coordinate, y_coordinate) VALUES
-- Зона 201
('201', '1', '1', 100, 100), ('201', '1', '2', 120, 100), ('201', '1', '3', 140, 100),
('201', '2', '1', 100, 120), ('201', '2', '2', 120, 120), ('201', '2', '3', 140, 120),
('201', '3', '1', 100, 140), ('201', '3', '2', 120, 140), ('201', '3', '3', 140, 140),

-- Зона 202
('202', '1', '1', 200, 100), ('202', '1', '2', 220, 100), ('202', '1', '3', 240, 100),
('202', '2', '1', 200, 120), ('202', '2', '2', 220, 120), ('202', '2', '3', 240, 120),
('202', '3', '1', 200, 140), ('202', '3', '2', 220, 140), ('202', '3', '3', 240, 140),

-- Зона 203
('203', '1', '1', 300, 100), ('203', '1', '2', 320, 100), ('203', '1', '3', 340, 100),
('203', '2', '1', 300, 120), ('203', '2', '2', 320, 120), ('203', '2', '3', 340, 120),
('203', '3', '1', 300, 140), ('203', '3', '2', 320, 140), ('203', '3', '3', 340, 140),

-- Зона 204 (VIP)
('204', '1', '1', 400, 100), ('204', '1', '2', 420, 100),
('204', '2', '1', 400, 120), ('204', '2', '2', 420, 120);

-- Добавляем цвета зон
INSERT INTO zone_colors (zone, color, name) VALUES
('201', '#179240', 'Зеленый'),
('202', '#8526d9', 'Фиолетовый'),
('203', '#921792', 'Розовый'),
('204', '#921792', 'Розовый'),
('205', '#e7cb14', 'Желтый'),
('206', '#ea3446', 'Красный'),
('207', '#ea3446', 'Красный'),
('208', '#ea3446', 'Красный'),
('209', '#e7cb14', 'Желтый'),
('210', '#921792', 'Розовый'),
('211', '#921792', 'Розовый'),
('212', '#8526d9', 'Фиолетовый'),
('213', '#179240', 'Зеленый');

-- Добавляем зоновые цены
INSERT INTO zone_pricing (event_id, zone, price, row_multipliers) VALUES
('550e8400-e29b-41d4-a716-446655440000', '201', 650.00, '{"1": 1.0, "2": 1.0, "3": 1.0}'),
('550e8400-e29b-41d4-a716-446655440000', '202', 850.00, '{"1": 1.0, "2": 1.0, "3": 1.0}'),
('550e8400-e29b-41d4-a716-446655440000', '203', 950.00, '{"1": 1.0, "2": 1.0, "3": 1.0}'),
('550e8400-e29b-41d4-a716-446655440000', '204', 950.00, '{"1": 1.0, "2": 1.0}'),
('550e8400-e29b-41d4-a716-446655440000', '205', 750.00, '{"1": 1.0, "2": 1.0}'),
('550e8400-e29b-41d4-a716-446655440000', '206', 1100.00, '{"1": 1.0, "2": 1.0}'),
('550e8400-e29b-41d4-a716-446655440000', '207', 1100.00, '{"1": 1.0, "2": 1.0}'),
('550e8400-e29b-41d4-a716-446655440000', '208', 1100.00, '{"1": 1.0, "2": 1.0}'),
('550e8400-e29b-41d4-a716-446655440000', '209', 750.00, '{"1": 1.0, "2": 1.0}'),
('550e8400-e29b-41d4-a716-446655440000', '210', 950.00, '{"1": 1.0, "2": 1.0}'),
('550e8400-e29b-41d4-a716-446655440000', '211', 950.00, '{"1": 1.0, "2": 1.0}'),
('550e8400-e29b-41d4-a716-446655440000', '212', 850.00, '{"1": 1.0, "2": 1.0}'),
('550e8400-e29b-41d4-a716-446655440000', '213', 650.00, '{"1": 1.0, "2": 1.0}');

-- Создаем места из шаблонов зон
SELECT create_seats_from_template('550e8400-e29b-41d4-a716-446655440000', '201');
SELECT create_seats_from_template('550e8400-e29b-41d4-a716-446655440000', '202');
SELECT create_seats_from_template('550e8400-e29b-41d4-a716-446655440000', '203');
SELECT create_seats_from_template('550e8400-e29b-41d4-a716-446655440000', '204');

-- Добавляем дополнительные места для других зон (205-213) с индивидуальными ценами
INSERT INTO seats (event_id, zone, row, number, price, custom_price, status, x_coordinate, y_coordinate) VALUES
-- Зона 205
('550e8400-e29b-41d4-a716-446655440000', '205', '1', '1', 800.00, TRUE, 'available', 500, 100),
('550e8400-e29b-41d4-a716-446655440000', '205', '1', '2', 800.00, TRUE, 'available', 520, 100),
('550e8400-e29b-41d4-a716-446655440000', '205', '2', '1', 900.00, TRUE, 'available', 500, 120),
('550e8400-e29b-41d4-a716-446655440000', '205', '2', '2', 900.00, TRUE, 'available', 520, 120),

-- Зона 206
('550e8400-e29b-41d4-a716-446655440000', '206', '1', '1', 700.00, TRUE, 'available', 600, 100),
('550e8400-e29b-41d4-a716-446655440000', '206', '1', '2', 700.00, TRUE, 'available', 620, 100),
('550e8400-e29b-41d4-a716-446655440000', '206', '2', '1', 800.00, TRUE, 'available', 600, 120),
('550e8400-e29b-41d4-a716-446655440000', '206', '2', '2', 800.00, TRUE, 'available', 620, 120);

-- Тестовый пользователь
INSERT INTO users (id, email, full_name, phone) VALUES 
(
  '123e4567-e89b-12d3-a456-426614174000',
  'test@example.com',
  'Тестовый Пользователь',
  '+7 (999) 123-45-67'
);

-- Тестовое бронирование
INSERT INTO bookings (id, user_id, event_id, total_amount, status, customer_info, expires_at) VALUES 
(
  '789e0123-e45f-6708-a901-23456789abcd',
  '123e4567-e89b-12d3-a456-426614174000',
  '550e8400-e29b-41d4-a716-446655440000',
  9500.00,
  'pending',
  '{"name": "Тестовый Пользователь", "email": "test@example.com", "phone": "+7 (999) 123-45-67"}',
  NOW() + INTERVAL '15 minutes'
);

-- Связь бронирования с местами (2 места в зоне 201)
INSERT INTO booking_seats (booking_id, seat_id) 
SELECT 
  '789e0123-e45f-6708-a901-23456789abcd',
  id
FROM seats 
WHERE event_id = '550e8400-e29b-41d4-a716-446655440000' 
  AND zone = '201' 
  AND row = '1' 
  AND number IN ('1', '2')
LIMIT 2;

-- Обновляем статус забронированных мест
UPDATE seats 
SET status = 'reserved'
WHERE event_id = '550e8400-e29b-41d4-a716-446655440000' 
  AND zone = '201' 
  AND row = '1' 
  AND number IN ('1', '2');

-- Тестовый платеж
INSERT INTO payments (booking_id, amount, payment_method, payment_provider, status) VALUES 
(
  '789e0123-e45f-6708-a901-23456789abcd',
  9500.00,
  'card',
  'stripe',
  'pending'
);

-- Обновляем счетчики мест в событии
UPDATE events 
SET 
  total_seats = (SELECT COUNT(*) FROM seats WHERE event_id = '550e8400-e29b-41d4-a716-446655440000'),
  available_seats = (SELECT COUNT(*) FROM seats WHERE event_id = '550e8400-e29b-41d4-a716-446655440000' AND status = 'available')
WHERE id = '550e8400-e29b-41d4-a716-446655440000';